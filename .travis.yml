sudo: required
language: python
services:
  - docker

before_install:
  - docker build -t untangled-be -f Dockerfile.test .

before_script:
  - docker run -e CI=true untangled-be
  - docker run -e POSTGRES_USER=username -e POSTGRES_PASSWORD=password -e POSTGRES_DB=untangled_test library/postgres:9.6-alpine
  - docker run /bin/bash "pg_ctl -D /var/lib/postgresql/data -l logfile start"
  - docker run /bin/bash -c "python3 manage.py db upgrade"

script:
  - docker run /bin/bash -c "pytest"
# language: python
# python:
# - '3.9.1'
# services:
# - postgresql
# addons:
#   postgresql: '9.6'
# install:
# - pip install -r requirements.txt
# before_script:
# - psql --version
# - psql -c 'create database untangled_test;' -U postgres
# - python manage.py db upgrade
# script:
# - pytest
# deploy:
#   provider: heroku
#   api_key:
#     secure:
#   app: untangled-be
#   on:
#     repo: 2008-Untangled/Untangled-BE
#     branch: main
#   skip_cleanup: 'true'
#   run:
#     - pip install -r requirements.txt
#     - python manage.py db upgrade
